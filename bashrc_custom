#!/bin/bash

alias ls="ls -hF"

if [[ "$OSTYPE" == "linux-gnu" ]]; then
	alias ls="ls --color"
elif [[ "$OSTYPE" == "darwin"* ]]; then
	alias ls="ls -G"
	alias start="open -n -a"
	alias vlc="/Applications/VLC.app/Contents/MacOS/VLC"
	export CLICOLOR=1
	export LSCOLORS=GxFxCxDxBxegedabagaced
fi

alias copy="cp"
alias ll="ls -l"
alias l="ll -a"
alias vi="vim"
alias lld="ll -d */"
alias lessn="less -N"
alias lessf="less +F"
alias svnst="svn status"
alias svnadd="svn status | grep --color=never \"?\" | cut -d \"?\" -f 2 | sed \"s/^ *//;s/ *$//\" | sed \"s/^/\\\"/;s/$/\\\"/\" | xargs -L1 svn add"
alias svndel="svn status | grep --color=never \"!\" | cut -d \"!\" -f 2 | sed \"s/^ *//;s/ *$//\" | sed \"s/^/\\\"/;s/$/\\\"/\" | xargs -L1 svn del"

alias cvlc="vlc --intf ncurses --no-color"

export SVN_EDITOR=/usr/bin/vim
alias grep="grep --color=always"

on_remote()
{
	exit 1

#	SSH_AUTH_SOCK=$(ls /tmp/*launchd*/Listeners)
	echo "Welcome, stranger"

	EXEC_SA="ssh-agent -sssss"

	echo "Currenty active ssh-agents:"
	ps auxww | grep ${EXEC_SA} | grep -v grep | sort

	echo "Killing older ones ..."
	ps -x -o pid,command | grep --color=never ${EXEC_SA} | grep -v grep | cut -d' ' -f 1 | xargs kill -KILL

	eval `${EXEC_SA}`
	ssh-add -K

	echo "Done, new one started, agents running:"
	ps auxww | grep ${EXEC_SA} | grep -v grep | sort
}

if [[ "$OSTYPE" == "linux-gnu" ]]; then
	test -s ~/.alias && . ~/.alias || true

	case $TERM in
		xterm*|rxvt*)
			TITLEBAR='\[\033]0;\u@\h:\w\007\]'
			;;
		*)
			TITLEBAR=""
			;;
	esac;
else
	#remote connection
	if [ ! -z "${SSH_CLIENT}" ]; then
		on_remote
	fi
fi

#  Prompt generated by Giles's Prompt-o-matic, 20081201
#  http://www.gilesorr.com/bashprompt/jsb/prompt.html

PS1="${TITLEBAR}\[\033[0m\]\[\033[1;32m\]\[\033[0m\]\[\033[0;37m\]\[\033[0m\]\[\033[0;37m\]\[\033[0m\]\[\033[1;30m\][\[\033[0m\]\[\033[0;37m\]\[\033[0m\]\[\033[0;37m\][\t]\[\033[0m\]\[\033[1;30m\]]\[\033[1;33m\]\u\[\033[0m\]\[\033[1;31m\]@\[\033[0m\]\[\033[1;34m\]\[\033[0m\]\[\033[0;32m\]\[\033[0m\]\[\033[1;32m\]\h \[\033[0m\]\[\033[0;32m\](\$(ppd=\"\${PWD}\"; let keep=4; let i=0; while [ \"\${ppd}\" != \"\" ]; do ppd=\"\${ppd%/*}\" ; let i=\$i+1; done; if [ \${keep} -ge \${i} ]; then echo \${PWD}; else newPWD=\"\${PWD}\"; while [ \${i} -ge \${keep} ]; do newPWD=\"\${newPWD#*/}\"; let i=\$i-1; done; echo \"<\${newPWD}\"; fi)) \[\033[0m\]\[\033[1;36m\]\[\033[0m\]\[\033[1;37m\]\[\033[1;37m\]\[\033[47m\]\[\033[0;30m\]\[\033[47m\]\[\033[1;33m\]\[\033[44m\]\[\033[1;33m\]\[\033[40m\]\[\033[1;34m\]\[\033[42m\]\[\033[1;36m\]\[\033[40m\]\[\033[1;33m\]\[\033[40m\]:\[\033[1;36m\]\[\033[40m\]:\[\033[0;0m\] "
